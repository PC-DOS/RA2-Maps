SCP-EQ-Tools_hoi4_base_game_ext_decisions_CHI_category = {

    SCP-EQ-Tools_hoi4_base_game_ext_decisions_CHI_JAP_fate_separator = {
        allowed = {
            # Always allowed
        }
        visible = {
            JAP = {
                is_subject_of = CHI
            }
        }
        available = {
            always = no
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
        }
    }
    SCP-EQ-Tools_hoi4_base_game_ext_decisions_CHI_JAP_fate_rename_occupied_zone = {
        allowed = {
            # Always allowed
        }
        visible = {
            JAP = {
                is_subject_of = CHI
            }
        }
        available = {
            JAP = {
                is_subject_of = CHI
            }
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            JAP = {
                set_cosmetic_tag = SCP-EQ-Tools_JAP_CHI_puppet_occupied_zone
                add_stability = 5.0
                remove_ideas = {
                    state_shintoism
                    JAP_zaibatsus
                    JAP_duplicate_research_efforts
                    JAP_militarism
                }
                load_focus_tree = SCP-EQ-Tools_hoi4_base_game_ext_national_focuses_empty_focus_tree
                set_popularities = {
                    democratic = 25
                    neutrality = 75
                    communism = 0
                    fascism = 0
                }
                set_party_name = {
                    ideology = democratic
                    long_name = SCP-EQ-Tools_JAP_CHI_puppet_democratic_party
                    name = SCP-EQ-Tools_JAP_CHI_puppet_democratic_party
                }
                set_party_name = {
                    ideology = neutrality
                    long_name = SCP-EQ-Tools_JAP_CHI_puppet_neutrality_party
                    name = SCP-EQ-Tools_JAP_CHI_puppet_neutrality_party
                }
                set_party_name = {
                    ideology = fascism
                    long_name = SCP-EQ-Tools_JAP_CHI_puppet_fascism_party
                    name = SCP-EQ-Tools_JAP_CHI_puppet_fascism_party
                }
            }
        }
    }
    SCP-EQ-Tools_hoi4_base_game_ext_decisions_CHI_JAP_fate_rename_SAR = {
        allowed = {
            # Always allowed
        }
        visible = {
            JAP = {
                is_subject_of = CHI
            }
        }
        available = {
            JAP = {
                is_subject_of = CHI
            }
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            JAP = {
                set_cosmetic_tag = SCP-EQ-Tools_JAP_CHI_puppet_SAR
                add_stability = 5.0
                remove_ideas = {
                    state_shintoism
                    JAP_zaibatsus
                    JAP_duplicate_research_efforts
                    JAP_militarism
                }
                load_focus_tree = SCP-EQ-Tools_hoi4_base_game_ext_national_focuses_empty_focus_tree
                set_popularities = {
                    democratic = 45
                    neutrality = 55
                    communism = 0
                    fascism = 0
                }
                set_party_name = {
                    ideology = democratic
                    long_name = SCP-EQ-Tools_JAP_CHI_puppet_democratic_party
                    name = SCP-EQ-Tools_JAP_CHI_puppet_democratic_party
                }
                set_party_name = {
                    ideology = neutrality
                    long_name = SCP-EQ-Tools_JAP_CHI_puppet_neutrality_party
                    name = SCP-EQ-Tools_JAP_CHI_puppet_neutrality_party
                }
                set_party_name = {
                    ideology = fascism
                    long_name = SCP-EQ-Tools_JAP_CHI_puppet_fascism_party
                    name = SCP-EQ-Tools_JAP_CHI_puppet_fascism_party
                }
            }
        }
    }
    SCP-EQ-Tools_hoi4_base_game_ext_decisions_CHI_JAP_fate_hirohito_execution = {
        allowed = {
            # Always allowed
        }
        visible = {
            JAP = {
                is_subject_of = CHI
            }
        }
        available = {
            JAP = {
                is_subject_of = CHI
            }
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            JAP = {
                kill_ideology_leader = fascism
                retire_character = JAP_emperor_hirohito
            }
            CHI = {
                country_event = SCP-EQ-Tools_hoi4_base_game_ext_events_CHI_execution_of_hirohito.1
                country_event = {
                    id = SCP-EQ-Tools_hoi4_base_game_ext_events_CHI_execution_of_hirohito.2
                    days = 1
                }
                country_event = {
                    id = SCP-EQ-Tools_hoi4_base_game_ext_events_CHI_execution_of_hirohito.3
                    days = 2
                }
                country_event = {
                    id = SCP-EQ-Tools_hoi4_base_game_ext_events_CHI_execution_of_hirohito.4
                    days = 3
                }
                country_event = {
                    id = SCP-EQ-Tools_hoi4_base_game_ext_events_CHI_execution_of_hirohito.5
                    days = 4
                }
            }
        }
    }
    SCP-EQ-Tools_hoi4_base_game_ext_decisions_CHI_JAP_fate_greate_purge = {
        allowed = {
            # Always allowed
        }
        visible = {
            JAP = {
                is_subject_of = CHI
            }
        }
        available = {
            JAP = {
                is_subject_of = CHI
            }
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            JAP = {
                every_character = {
                    retire = yes
                }
            }
            CHI = {
                country_event = SCP-EQ-Tools_hoi4_base_game_ext_events_CHI_tokyo_is_nanking.1
            }
        }
    }
    SCP-EQ-Tools_hoi4_base_game_ext_decisions_CHI_JAP_fate_pause_military_supervision = {
        allowed = {
            # Always allowed
        }
        visible = {
            JAP = {
                is_subject_of = CHI
            }
        }
        available = {
            JAP = {
                is_subject_of = CHI
            }
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            JAP = {
                delete_unit = {
                    disband = no
                }
                add_stability = 5.0
                every_controlled_state = {
                    # Tokyo is Nanking, too
                    add_manpower = -1245000
                    JAP = {
                        add_manpower = -1245000
                    }
                    if = {
                        limit = {
                            state_population_k < 0.001
                            state_population < 1
                        }
                        add_manpower = 1
                    }
                    # Damage building
                    add_extra_state_shared_building_slots = -5
                    damage_building = {
                        type = infrastructure
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = arms_factory
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = industrial_complex
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = air_base
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = dockyard
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = anti_air_building
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = synthetic_refinery
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = fuel_silo
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = radar_station
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = rocket_site
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    damage_building = {
                        type = nuclear_reactor
                        damage = 25
                        repair_speed_modifier = -5.0
                    }
                    # Remove military buildings
                    remove_building = {
                        type = arms_factory
                        level = 25
                    }
                    remove_building = {
                        type = dockyard
                        level = 25
                    }
                    remove_building = {
                        type = air_base
                        level = 25
                    }
                    remove_building = {
                        type = anti_air_building
                        level = 25
                    }
                    remove_building = {
                        type = rocket_site
                        level = 25
                    }
                    remove_building = {
                        type = nuclear_reactor
                        level = 25
                    }
                }
            }
            CHI = {
                country_event = SCP-EQ-Tools_hoi4_base_game_ext_events_CHI_tokyo_is_nanking.2
            }
        }
    }
    SCP-EQ-Tools_hoi4_base_game_ext_decisions_CHI_JAP_fate_overall_nuke_experiment = {
        allowed = {
            # Always allowed
        }
        visible = {
            JAP = {
                is_subject_of = CHI
            }
        }
        available = {
            JAP = {
                is_subject_of = CHI
            }
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            set_temp_variable = { temp_param_nuke_target_tag = JAP }
            set_temp_variable = { temp_param_nuke_sender_tag = ROOT } 
            set_temp_variable = { temp_param_is_advanced_nuking_enabled = 1 }
            JAP = {
                every_controlled_state = {
                    set_temp_variable = { temp_param_nuke_target_state = THIS }
                    var:temp_param_nuke_target_state = {
                        set_temp_variable = { temp_nuke_target_state = THIS }
                        log = "Nuking state: [?temp_nuke_target_state.GetID] ([?temp_nuke_target_state.GetName])"
                        var:temp_param_nuke_sender_tag = {
                            launch_nuke = {
                                state = temp_nuke_target_state
                                controller = var:temp_param_nuke_target_tag
                                use_nuke = no
                            }
                        }
                        if = {
                            limit = {
                                check_variable = { temp_param_is_advanced_nuking_enabled > 0 }
                            }
                            # Go hell with your Showa bullshit, JAPs!
                            # Delete all units immediately
                            var:temp_param_nuke_target_tag = {
                                delete_unit = {
                                    state = PREV
                                    disband = no
                                }
                            }
                            # Ensure minimal killing
                            add_manpower = -1245000
                            var:temp_param_nuke_target_tag = {
                                add_manpower = -1245000
                            }
                            # Avoid killing all
                            # Leave at least 1 person for the target state
                            # If you killed all pupulation of the target state, the state's population will revert to manpower defined in history/states after save-load sequence
                            if = {
                                limit = {
                                    state_population_k < 0.001
                                    state_population < 1
                                }
                                add_manpower = 1
                            }
                        }
                    }
                }
            }
            for_each_loop = {
                array = global.province_controllers
                value = temp_current_province_controller
                index = temp_current_province_id
                
                if = {
                    limit = {
                        check_variable = { temp_current_province_controller = temp_param_nuke_target_tag }
                    }
                    var:temp_param_nuke_sender_tag = {
                        launch_nuke = {
                            province = var:temp_current_province_id
                            use_nuke = no
                        }
                    }
                }
            }
        }
    }
    
}
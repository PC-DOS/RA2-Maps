SCP-EQ-Tools_enhancing_decisions_state_operations_category = {

    # On-map decisions
    SCP-EQ-Tools_enhancing_decisions_state_operations_mark_this_state = {
        state_target = yes
        target_array = global.states
        visible = {
            ROOT = {
                has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
            }
            FROM = {
                NOT = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
            }
        }
        on_map_mode = map_only
        icon = GFX_SCP-EQ-Tools_generic_icons_add
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        cost = 0
        complete_effect = {
            FROM = {
                set_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_unmark_this_state = {
        state_target = yes
        target_array = global.states
        visible = {
            ROOT = {
                has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
            }
            FROM = {
                has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
            }
        }
        on_map_mode = map_only
        icon = GFX_SCP-EQ-Tools_generic_icons_minus
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        cost = 0
        complete_effect = {
            FROM = {
                clr_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
            }
        }
    }
    
    # Generic operations
    SCP-EQ-Tools_enhancing_decisions_state_operations_clear_all_marks = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                clr_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_own_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                # set_state_owner (country scope) or set_state_owner_to (state scope) may cause problems
                # Using transfer_state_to is recommended
                # See:
                # https://hoi4.paradoxwikis.com/Effect#set_state_owner
                # https://hoi4.paradoxwikis.com/Effect#set_state_owner_to
                transfer_state_to = ROOT
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_control_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                set_state_controller_to = ROOT
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_add_core_on_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                add_core_of = ROOT
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_remove_others_core_and_claim_on_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            for_each_loop = {
                array = global.countries
                value = temp_current_country
                
                if = {
                    limit = {
                        NOT = {
                            check_variable = { temp_current_country = ROOT }
                        }
                    }
                    every_state = {
                        limit = {
                            has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                        }
                        remove_claim_by = temp_current_country
                        remove_core_of = temp_current_country
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_remove_our_core_and_claim_on_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                remove_claim_by = ROOT
                remove_core_of = ROOT
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_delete_non_allied_armies_in_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                every_possible_country = {
                    limit = {
                        NOT = { tag = ROOT }
                        NOT = { is_ally_with = ROOT }
                        NOT = { is_in_faction_with = ROOT }
                        NOT = { is_puppet_of = ROOT }
                        NOT = { is_subject_of = ROOT }
                    }
                    delete_unit = {
                        state = PREV
                        disband = no
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_set_demilitarized_zone_on_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                set_demilitarized_zone = yes
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_unset_demilitarized_zone_on_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                set_demilitarized_zone = no
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_teleport_capital_armies_to_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            clear_temp_array = temp_arr_teleporting_targets
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                log = "Adding teleporting target [?THIS.GetName]"
                add_to_temp_array = { temp_arr_teleporting_targets = THIS }
                # You can only teleport armies to controlled states, thus we will set state controller before teleporting
                if = {
                    # Case 1: We are having war with this state's controller
                    limit = {
                        controller = {
                            has_war_with = ROOT
                        }
                    }
                    controller = {
                        delete_unit = {
                            state = PREV
                            disband = no
                        }
                    }
                    set_state_controller_to = ROOT
                }
                else_if = {
                    # Case 2: We are in peace with this state's controller
                    limit = {
                        NOT = {
                            is_controlled_by = ROOT
                        }
                    }
                    controller = {
                        delete_unit = {
                            state = PREV
                            disband = no
                        }
                    }
                    transfer_state_to = ROOT
                }
            }
            ROOT = {
                capital_scope = {
                    for_each_loop = {
                        array = temp_arr_teleporting_targets
                        value = temp_teleporting_target
                        
                        log = "Teleporting armies from [?THIS.GetName] to [?temp_teleporting_target.GetName]"
                    }
                    teleport_armies = {
                        to_state_array = temp_arr_teleporting_targets
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_teleport_our_armies_in_marked_states_to_capital = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                teleport_armies = {
                    limit = {
                        OR = {
                            tag = ROOT
                            is_ally_with = ROOT
                            is_in_faction_with = ROOT
                            is_puppet_of = ROOT
                            is_subject_of = ROOT
                        }
                    }
                    to_state = ROOT.capital
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_nuke_marked_states = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                set_temp_variable = { temp_param_nuke_target_tag = controller }
                set_temp_variable = { temp_param_nuke_sender_tag = ROOT }
                set_temp_variable = { temp_param_nuke_target_state = THIS }
                set_temp_variable = { temp_param_is_advanced_nuking_enabled = 1 }
                SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state = yes
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_nuke_marked_states_controllers = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                }
                set_temp_variable = { temp_param_nuke_target_tag = controller }
                set_temp_variable = { temp_param_nuke_sender_tag = ROOT }
                set_temp_variable = { temp_param_is_advanced_nuking_enabled = 1 }
                SCP-EQ-Tools_generic_scripted_effects_nuke_all_controlled_states = yes
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_annex_marked_states_controllers = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                    NOT = {
                        is_controlled_by = ROOT
                    }
                }
                controller = {
                    ROOT = {
                        annex_country = {
                            target = PREV
                            transfer_troops = yes
                        }
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_puppet_marked_states_controllers = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                    NOT = {
                        is_controlled_by = ROOT
                    }
                }
                controller = {
                    ROOT = {
                        puppet = {
                            target = PREV
                        }
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_gain_military_access_from_marked_states_controllers = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                    NOT = {
                        is_controlled_by = ROOT
                    }
                }
                controller = {
                    give_military_access = ROOT
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_remove_guarantees_of_marked_states_controllers = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                    NOT = {
                        is_controlled_by = ROOT
                    }
                }
                controller = {
                    every_possible_country = {
                        limit = {
                            is_ai = yes
                        }
                        diplomatic_relation = {
                            country = PREV
                            relation = guarantee
                            active = no
                        }
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_declare_war_on_marked_states_controllers = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                    NOT = {
                        is_controlled_by = ROOT
                    }
                }
                controller = {
                    ROOT = {
                        declare_war_on = {
                            target = PREV
                            type = annex_everything
                        }
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_add_to_faction_of_marked_states_controller = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                    NOT = {
                        is_controlled_by = ROOT
                    }
                }
                controller = {
                    faction_leader = {
                        add_to_faction = ROOT
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_marked_states_controllers_join_our_faction = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            every_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                    NOT = {
                        is_controlled_by = ROOT
                    }
                }
                controller = {
                    leave_faction = yes
                    dismantle_faction = yes
                    set_temp_variable = { temp_target_country = THIS }
                    ROOT = {
                        faction_leader = {
                            add_to_faction = temp_target_country
                        }
                    }
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
            NOT = {
                has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_is_tagged_from_another_country
            }
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            random_state = {
                limit = {
                    has_state_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_is_this_state_marked
                    NOT = {
                        is_controlled_by = ROOT
                    }
                }
                controller = {
                    set_variable = { SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_source = ROOT }
                    set_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_is_tagged_from_another_country
                    set_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
                    change_tag_from = ROOT
                }
            }
        }
    }
    SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_revert = {
        allowed = {
            # Always allowed
        }
        visible = {
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_enabled
            has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_is_tagged_from_another_country
        }
        available = {
            # Always available
        }
        icon = GFX_SCP-EQ-Tools_generic_icons_SCP_1_Generic_Small
        fire_only_once = no
        days_re_enable = 0
        ai_will_do = {
            factor = 0
        }
        complete_effect = {
            if = {
                limit = {
                    has_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_is_tagged_from_another_country
                }
                set_temp_variable = { temp_tag_target = SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_source }
                set_temp_variable = { temp_tag_source = THIS }
                clr_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_is_tagged_from_another_country
                clr_country_flag = SCP-EQ-Tools_enhancing_decisions_state_operations_tag_to_random_marked_state_controller_source
                var:temp_tag_target = {
                    change_tag_from = var:temp_tag_source
                }
            }
        }
    }

}
on_actions = {
    on_startup = {
        effect = {
            # Set some global flags
            random_country = {
                # Advanced nuking
                set_variable = { global.SCP-EQ-Tools_enhancing_decisions_is_advanced_nuking_enabled = 1 }
                set_variable = { global.SCP-EQ-Tools_enhancing_decisions_is_advanced_nuking_radiation_time = 730 }
                # Prevent AI from leaving factions from diplomacy UI by default
                set_variable = { global.SCP-EQ-Tools_enhancing_decisions_ai_faction_operation_level = 2 }
            }
        }
    }
    on_daily = {
        effect = {
            # Execute some monthly effect
            if = {
                limit = {
                    has_country_flag = SCP-EQ-Tools_generic_on_actions_new_month_starts
                }
                # TFR: Handles debt and inflation
                if = {
                    limit = {
                        check_variable = { SCP-EQ-Tools_enhancing_decisions_TFR_toggle_debt_and_inflation_auto_handling_enabled > 0 }
                    }
                    SCP-EQ-Tools_generic_scripted_effects_TFR_clear_debt = yes
                    SCP-EQ-Tools_generic_scripted_effects_TFR_reset_inflation = yes
                }
                # TNO: Handles debt and money reserve
                if = {
                    limit = {
                        check_variable = { SCP-EQ-Tools_enhancing_decisions_TNO_toggle_debt_and_money_reserves_auto_handling_enabled > 0 }
                    }
                    SCP-EQ-Tools_generic_scripted_effects_TNO_clear_debt_and_money_reserves = yes
                }
                # Remember clearing the flag
                clr_country_flag = SCP-EQ-Tools_generic_on_actions_new_month_starts
            }
            # Handles "nuclear radiation" effect dealt by SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state
            # Radiation kills local people
            every_controlled_state = {
                limit = {
                    has_state_flag = {
                        flag = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_is_this_state_nuked
                    }
                }
                # Check if controller is not ally with last nuke sender, or ally immunity is disabled
                if = {
                    limit = {
                        controller = {
                            has_country_flag = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_is_this_country_nuked
                            OR = {
                                check_variable = { global.SCP-EQ-Tools_enhancing_decisions_is_advanced_nuking_ignores_allies_manpower_part = 0 }
                                AND = {
                                    NOT = { tag = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                    NOT = { is_ally_with = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                    NOT = { is_in_faction_with = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                    NOT = { is_puppet_of = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                    NOT = { is_subject_of = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                }
                            }
                        }
                    }
                    #log = "Radiation effect on [?THIS.GetName] controlled by [?controller.GetName]"
                    set_temp_variable = { temp_param_state_population_change_percentage = -0.05 }
                    set_temp_variable = { temp_param_is_side_effect_handled = 1 }
                    multiply_temp_variable = { temp_param_state_population_change_percentage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                    SCP-EQ-Tools_generic_scripted_effects_change_state_population_by_percentage = yes
                }
            }
            # Radiation damages units
            if = {
                limit = {
                    has_country_flag = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_is_this_country_nuked
                }
                every_controlled_state = {
                    limit = {
                        has_state_flag = {
                            flag = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_is_this_state_nuked
                        }
                    }
                    # Check if controller is not ally with last nuke sender, or ally immunity is disabled
                    if = {
                        limit = {
                            controller = {
                                OR = {
                                    check_variable = { global.SCP-EQ-Tools_enhancing_decisions_is_advanced_nuking_ignores_allies_misc_part = 0 }
                                    AND = {
                                        NOT = { tag = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                        NOT = { is_ally_with = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                        NOT = { is_in_faction_with = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                        NOT = { is_puppet_of = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                        NOT = { is_subject_of = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                    }
                                }
                            }
                        }
                        set_temp_variable = { temp_damage_to_units = 0.05 }
                        multiply_temp_variable = { temp_damage_to_units = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        damage_units = {
                            state = THIS
                            limit = { has_country_flag = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_is_this_country_nuked }
                            damage = var:temp_damage_to_units
                            org_damage = var:temp_damage_to_units
                            str_damage = var:temp_damage_to_units
                            ratio = yes
                            army = yes
                            navy = yes
                        }
                    }
                }
            }
            # Every nuked state will do harm to its controller at that time, unless the controller have lost the states' control
            # Harm is judged by the state's radiation level
            if = {
                limit = {
                    has_country_flag = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_is_this_country_nuked
                }
                every_controlled_state = {
                    limit = {
                        has_state_flag = {
                            flag = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_is_this_state_nuked
                        }
                    }
                    # Check if controller is not ally with last nuke sender, or ally immunity is disabled
                    if = {
                        limit = {
                            controller = {
                                OR = {
                                    check_variable = { global.SCP-EQ-Tools_enhancing_decisions_is_advanced_nuking_ignores_allies_misc_part = 0 }
                                    AND = {
                                        NOT = { tag = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                        NOT = { is_ally_with = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                        NOT = { is_in_faction_with = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                        NOT = { is_puppet_of = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                        NOT = { is_subject_of = PREV.SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_last_nuke_sender }
                                    }
                                }
                            }
                        }
                        set_temp_variable = { temp_political_power_damage = -5 }
                        set_temp_variable = { temp_command_power_damage = -5 }
                        set_temp_variable = { temp_manpower_damage = -25 }
                        set_temp_variable = { temp_army_experience_damage = -5 }
                        set_temp_variable = { temp_navy_experience_damage = -5 }
                        set_temp_variable = { temp_air_experience_damage = -5 }
                        set_temp_variable = { temp_stability_damage = -0.05 }
                        set_temp_variable = { temp_war_support_damage = -0.05 }
                        multiply_temp_variable = { temp_political_power_damage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        multiply_temp_variable = { temp_command_power_damage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        multiply_temp_variable = { temp_manpower_damage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        multiply_temp_variable = { temp_army_experience_damage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        multiply_temp_variable = { temp_navy_experience_damage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        multiply_temp_variable = { temp_air_experience_damage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        multiply_temp_variable = { temp_stability_damage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        multiply_temp_variable = { temp_war_support_damage = SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state_current_state_radiation_level }
                        controller = {
                            add_political_power = var:temp_political_power_damage
                            add_command_power = var:temp_command_power_damage
                            add_manpower = var:temp_manpower_damage
                            army_experience = var:temp_army_experience_damage
                            navy_experience = var:temp_navy_experience_damage
                            air_experience = var:temp_air_experience_damage
                            add_stability = var:temp_stability_damage
                            add_war_support = var:temp_war_support_damage
                        }
                    }
                }
            }
        }
    }
    on_weekly = {
        effect = {
            # Theoretically, this shoud be implemented in on_monthly
            # I put it here for flexibility
            # TFR: Handles debt and inflation
            if = {
                limit = {
                    check_variable = { SCP-EQ-Tools_enhancing_decisions_TFR_toggle_debt_and_inflation_auto_handling_enabled > 0 }
                }
                SCP-EQ-Tools_generic_scripted_effects_TFR_clear_debt = yes
                SCP-EQ-Tools_generic_scripted_effects_TFR_reset_inflation = yes
            }
            # TNO: Handles debt and money reserve
            if = {
                limit = {
                    check_variable = { SCP-EQ-Tools_enhancing_decisions_TNO_toggle_debt_and_money_reserves_auto_handling_enabled > 0 }
                }
                SCP-EQ-Tools_generic_scripted_effects_TNO_clear_debt_and_money_reserves = yes
            }
        }
    }
    on_monthly = {
        effect = {
            # Mark the begining of a new month, allow "scheduling" some monthly events which depends on executing sequence
            # E.g. another mod's on_monthly effect sets a variable, and we want to clear the variable every month. If we use simple on_monthly effect, we may execute before the variable is set, casuing problems
            set_country_flag = SCP-EQ-Tools_generic_on_actions_new_month_starts
            # Handles "nuclear radiation" effect dealt by SCP-EQ-Tools_generic_scripted_effects_nuke_specified_state
            every_controlled_state = {
                SCP-EQ-Tools_generic_scripted_effects_reduct_nuke_effects_on_specified_state = yes
            }
            # Check if we need to remove this country's "nuked" flag
            SCP-EQ-Tools_generic_scripted_effects_check_and_set_country_nuked_flag = yes
        }
    }
}